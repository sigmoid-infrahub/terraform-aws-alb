{
    "resourceSpecId": "33333333-3333-4333-8333-333333333331",
    "stableId": "main-alb",
    "displayName": "Main Application Load Balancer",
    "category": "network",
    "iconUrl": "https://cdn.sigmoid.us/icons/aws/full-size/svg/networking/elb.svg",
    "resourceType": "loadbalancer.elb",
    "vpcDependency": "required",
    "status": "draft",
    "inputs": {
        "name": "sigmoid-main-alb",
        "load_balancer_type": "application",
        "internal": false,
        "vpc_id": { "ref": "main-vpc.id", "required": true },
        "subnet_ids": [
            { "ref": "public-subnet-1.id", "required": true },
            { "ref": "public-subnet-2.id", "required": true }
        ],
        "security_group_ids": [
            { "ref": "alb-sg.id", "required": true }
        ],
        "subnets": [
            { "ref": "public-subnet-1.id", "required": true },
            { "ref": "public-subnet-2.id", "required": true }
        ],
        "security_groups": [
            { "ref": "alb-sg.id", "required": true }
        ],
        "enable_deletion_protection": true,
        "enable_cross_zone_load_balancing": true,
        "idle_timeout": 60,
        "enable_http2": true,
        "drop_invalid_header_fields": true,
        "access_logs": {
            "enabled": true,
            "bucket": { "ref": "logs-bucket.id" },
            "prefix": "alb-logs"
        },
        "listeners": [
            {
                "port": 80,
                "protocol": "HTTP",
                "default_action": {
                    "type": "redirect",
                    "redirect": {
                        "port": "443",
                        "protocol": "HTTPS",
                        "status_code": "HTTP_301"
                    }
                }
            },
            {
                "port": 443,
                "protocol": "HTTPS",
                "ssl_policy": "ELBSecurityPolicy-TLS13-1-2-2021-06",
                "certificate_arn": { "ref": "acm-cert.arn" },
                "default_action": {
                    "type": "forward",
                    "target_group_key": "main-tg"
                }
            }
        ],
        "target_groups": [
            {
                "name": "sigmoid-main-tg",
                "backend_protocol": "HTTP",
                "backend_port": 8080,
                "target_type": "ip",
                "health_check": {
                    "enabled": true,
                    "path": "/health",
                    "port": "traffic-port",
                    "protocol": "HTTP",
                    "healthy_threshold": 2,
                    "unhealthy_threshold": 3,
                    "timeout": 5,
                    "interval": 30
                }
            }
        ],
        "tags": {
            "Environment": "production",
            "Project": "sigmoid"
        }
    },
    "inputSpecs": [
        { "name": "name", "type": "string", "required": true, "description": "Load balancer name" },
        { "name": "load_balancer_type", "type": "string", "required": true, "validation": { "enum": ["application", "network", "gateway"] }, "description": "Type of load balancer" },
        { "name": "internal", "type": "boolean", "required": false, "default": false, "description": "Whether the load balancer is internal" },
        { "name": "vpc_id", "type": "string", "required": true, "description": "VPC ID where the load balancer will be created" },
        { "name": "subnet_ids", "type": "array", "required": true, "description": "List of subnet IDs for the load balancer" },
        { "name": "security_group_ids", "type": "array", "required": false, "description": "List of security group IDs (ALB only)" },
        { "name": "subnets", "type": "array", "required": true, "description": "List of subnet IDs for the load balancer (legacy)" },
        { "name": "security_groups", "type": "array", "required": false, "description": "List of security group IDs (ALB only, legacy)" },
        { "name": "enable_deletion_protection", "type": "boolean", "required": false, "default": false, "description": "Enable deletion protection" },
        { "name": "enable_cross_zone_load_balancing", "type": "boolean", "required": false, "default": true, "description": "Enable cross-zone load balancing" },
        { "name": "idle_timeout", "type": "number", "required": false, "default": 60, "validation": { "min": 1, "max": 4000 }, "description": "Idle timeout in seconds (ALB only)" },
        { "name": "enable_http2", "type": "boolean", "required": false, "default": true, "description": "Enable HTTP/2 (ALB only)" },
        { "name": "drop_invalid_header_fields", "type": "boolean", "required": false, "default": false, "description": "Drop invalid header fields (ALB only)" },
        { "name": "access_logs", "type": "object", "required": false, "description": "Access logs configuration" },
        { "name": "listeners", "type": "array", "required": false, "description": "List of listener configurations" },
        { "name": "target_groups", "type": "array", "required": false, "description": "List of target group configurations" },
        { "name": "tags", "type": "object", "required": false, "description": "Resource tags" }
    ],
    "scope": {
        "vpcId": "main-vpc"
    },
    "position": { "x": 200, "y": 100 },
    "terraform": {
        "module": {
            "source": "github.com/sigmoid-hq/terraform-aws-alb",
            "ref": "main"
        }
    }
}
